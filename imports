#!/bin/bash

die () {
    echo "$*"
    exit 1
}

INPUT="$1"
if [[ -z "$INPUT" ]]; then
	die "usage: imports <filename>"
fi

function replace () {
	local A=$1
	local B=$2
	sed -i "s/^import static $A/import static $B/g" "$INPUT"
	sed -i "s/^import $A/import $B/g" "$INPUT"
}

function delete () {
	sed -i "/${1}$/d" $INPUT
}

sed -i "s/^import com.google.common.base.Equivalence;/import io.jbock.auto.common.Equivalence;/" $INPUT
sed -i "s/^import com.google.common.base.Supplier;/import java.util.function.Supplier;/" $INPUT

replace com.google.auto.common. io.jbock.auto.common.
replace com.google.common.base. dagger.internal.codegen.base.
replace androidx.room.compiler.processing.compat.XConverters dagger.internal.codegen.xprocessing.XConverters
replace com.squareup.javapoet. io.jbock.javapoet.
replace androidx.room.compiler.processing. dagger.internal.codegen.xprocessing.
replace com.google.common.collect. dagger.internal.codegen.collect.
replace com.google.common.graph. io.jbock.common.graph.
replace com.google.auto.common. io.jbock.auto.common.
replace javax.inject. jakarta.inject.
replace com.google.auto.value.AutoValue io.jbock.auto.value.AutoValue
replace com.google.auto.value.extension.memoized.Memoized io.jbock.auto.value.extension.memoized.Memoized
replace dagger.internal.codegen.xprocessing.XTypeKt. dagger.internal.codegen.xprocessing.XType.

delete "import com.google.errorprone.annotations.CheckReturnValue;"
delete "@CheckReturnValue"
delete "import com.google.errorprone.annotations.CanIgnoreReturnValue;"
delete "@CanIgnoreReturnValue"
delete "import com.google.common.annotations.Beta;"
delete "@Beta"
delete "import com.google.common.annotations.GwtCompatible;"
delete "@GwtCompatible"
delete "import javax.annotation.CheckForNull;"
delete "import org.checkerframework.checker.nullness.qual.Nullable;"
delete "@ElementTypesAreNonnullByDefault"
delete "import dagger.internal.codegen.base.MapType;"
delete "import dagger.internal.codegen.base.SetType;"

sed -i "s/<? extends @Nullable Object>/<?>/g" $INPUT
sed -i "s/@CheckForNull //g" $INPUT
sed -i "s/@Nullable //g" $INPUT
